<!DOCTYPE html>
<html lang="en" class="h-full">
  <%- include('partials/head', { title: 'Home page | Members Only' }) %>

  <body class="flex h-full flex-col">
    <%- include('partials/nav') %>
    <main class="mx-auto w-full max-w-xl flex-1 px-4 py-8">
      <% const user=locals.currentUser; const msgs=locals.messages || []; const
      isMember=Boolean(user && user.membership); %>
      <div class="mb-8 text-center">
        <% if (user) { %>
        <h1 class="mb-2 text-3xl font-bold text-gray-900">
          Welcome back, <%= user.fullname %>!
        </h1>
        <p class="text-gray-600">Share your thoughts with the community</p>
        <% } else { %>
        <h1 class="mb-2 text-3xl font-bold text-gray-900">
          Welcome to Members Only!
        </h1>
        <p class="mb-4 text-gray-600">
          A private clubhouse for exclusive conversations
        </p>
        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <a href="/login" class="btn-primary-blue">Login</a>
          <a href="/register" class="btn-primary-green">Join Now</a>
        </div>
        <% } %>
      </div>
      <% if (msgs.length> 0) { %>
      <div class="space-y-6">
        <div
          class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"
        >
          <h2 class="text-2xl font-semibold text-gray-900">Recent Messages</h2>
          <% if (user) { %>
          <a href="/messages/new" class="btn-primary-blue">New Message</a>
          <% } %>
        </div>
        <div class="space-y-4">
          <% msgs.forEach(message=> { const dateStr = new
          Date(message.created_at).toLocaleDateString(); const username =
          isMember ? message.username : '█'.repeat(message.username.length);
          const date = isMember ? dateStr : '█'.repeat(dateStr.length); const
          status = message.admin ? 'ADMIN' : (message.membership ? 'MEMBER' :
          'GUEST'); const statusColor = message.admin ? 'bg-violet-100
          text-violet-800' : (message.membership ? 'bg-blue-100 text-blue-800' :
          'bg-gray-100 text-gray-800'); %>
          <div class="message-card">
            <div
              class="mb-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"
            >
              <div
                class="flex flex-col sm:flex-row sm:items-center sm:space-x-3"
              >
                <span class="font-medium text-gray-900"> <%= username %> </span>
                <span class="text-sm text-gray-500"> <%= date %> </span>
              </div>
              <div class="flex items-center gap-2">
                <span
                  class="<%= statusColor %> rounded-full px-2 py-1 text-xs font-medium"
                >
                  <%= status %>
                </span>
              </div>
            </div>
            <h3 class="mb-2 text-lg font-semibold text-gray-900">
              <%= message.title %>
            </h3>
            <p class="mb-2 leading-relaxed text-gray-700">
              <%= message.text %>
            </p>
            <% if (user && user.admin) { %>
            <form
              method="POST"
              action="/messages/delete/<%= message.message_id %>"
            >
              <button
                type="submit"
                class="cursor-pointer text-sm font-medium text-red-600 hover:text-red-800"
                onclick="
                  return confirm(
                    'Are you sure you want to delete this message?',
                  );
                "
              >
                Delete
              </button>
            </form>
            <% } %>
          </div>
          <% }) %>
        </div>
      </div>
      <% } else { %>
      <div class="py-12 text-center">
        <div class="mx-auto max-w-md">
          <h3 class="mb-2 text-lg font-medium text-gray-900">
            No messages yet
          </h3>
          <p class="mb-4 text-gray-600">
            Be the first to start a conversation!
          </p>
          <% if (user) { %>
          <a href="/messages/new" class="btn-primary-blue"
            >Create First Message</a
          >
          <% } %>
        </div>
      </div>
      <% } %>
    </main>
    <%- include('partials/footer') %>
  </body>
</html>
